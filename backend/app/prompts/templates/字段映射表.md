# 字段 → 文案片段映射表

## 基于JSON Schema的字段映射

### 企业基本信息字段
| 字段名 | 模板中的使用场景 | 句法结构 | 示例文案 |
|--------|----------------|----------|----------|
| enterprise_name | 企业标题、落款处 | `{{ enterprise_name }}` | XXX（单位名称） |
| industry_type | 企业概况描述 | `{{ industry_type }}` | 从事XX行业的XX类型企业 |
| address | 企业地理位置 | `{{ address }}` | 位于XX省XX市XX区XX路XX号 |
| main_products | 主要产品描述 | `{{ main_products }}` | 主要产品为XX、XX等 |
| employees_count | 员工数量 | `{{ employees_count }}` | 现有员工XX人 |

### 环境风险字段
| 字段名 | 模板中的使用场景 | 句法结构 | 示例文案 |
|--------|----------------|----------|----------|
| hazardous_materials | 危险物质列表 | `{% for material in hazardous_materials %}{{ material.name }}{% endfor %}` | 企业涉及的危险化学品有：XX、XX等 |
| storage_amounts | 存储量信息 | `{% for item in storage_amounts %}{{ item.amount }}{% endfor %}` | 最大存储量为XX吨 |
| surrounding_receptors | 周边环境受体 | `{% for receptor in surrounding_receptors %}{{ receptor.name }}{% endfor %}` | 周边敏感目标有：XX居民区、XX河流等 |

### 应急管理字段
| 字段名 | 模板中的使用场景 | 句法结构 | 示例文案 |
|--------|----------------|----------|----------|
| emergency_team_structure | 应急组织结构 | `{% for team in emergency_team_structure %}{{ team.name }}：{{ team.leader }}{% endfor %}` | 总指挥：XX，副总指挥：XX |
| emergency_resources | 应急资源清单 | `{% for resource in emergency_resources %}{{ resource.name }}：{{ resource.quantity }}{{ resource.unit }}{% endfor %}` | 应急物资：灭火器XX个，防护服XX套 |
| incident_types | 事件类型列表 | `{% for incident in incident_types %}{{ incident.type }}{% endfor %}` | 可能发生的事件：泄漏、火灾、爆炸等 |
| response_steps | 响应步骤 | `{% for step in response_steps %}{{ step.order }}. {{ step.content }}{% endfor %}` | 1.发现事故 2.启动预案 3.组织救援 |

## 三个模板的特定字段映射

### 1. 突发环境事件应急预案 (template_emergency_plan.jinja2)
| 变量名 | 使用位置 | 条件逻辑 |
|--------|----------|----------|
| {{ enterprise_name }} | 标题、多处 | 必填 |
| {{ plan_version }} | 版本号 | 可选，默认"第X版" |
| {{ record_date }} | 备案日期 | 可选 |
| {{ legal_representative }} | 法定代表人 | 必填 |
| {{ contact_person }} | 联系人 | 必填 |
| {{ contact_phone }} | 联系电话 | 必填 |
| {% if risk_level == 'L' %}一般环境风险等级（L）{% endif %} | 风险级别 | 条件判断 |
| {% for material in hazardous_materials %}...{% endfor %} | 危险物质列表 | 循环 |

### 2. 环境风险评估报告 (template_risk_plan.jinja2)
| 变量名 | 使用位置 | 条件逻辑 |
|--------|----------|----------|
| {{ enterprise_name }} | 标题、多处 | 必填 |
| {{ assessment_date }} | 评估日期 | 可选 |
| {{ q_value }} | Q值计算结果 | 必填 |
| {% if q_value < 1 %}一般环境风险{% elif q_value < 10 %}较大环境风险{% else %}重大环境风险{% endif %} | 风险等级判断 | 条件判断 |
| {% for material in risk_materials %}...{% endfor %} | 风险物质表格 | 循环 |
| {% for receptor in environmental_receptors %}...{% endfor %} | 环境受体表格 | 循环 |

### 3. 应急资源调查报告 (template_resource_investigation.jinja2)
| 变量名 | 使用位置 | 条件逻辑 |
|--------|----------|----------|
| {{ enterprise_name }} | 标题、多处 | 必填 |
| {{ investigation_date }} | 调查日期 | 可选 |
| {% for team in emergency_teams %}...{% endfor %} | 应急队伍表格 | 循环 |
| {% for resource in emergency_resources %}...{% endfor %} | 应急物资表格 | 循环 |
| {% if external_support %}...{% endif %} | 外部支援 | 条件判断 |

## 动态内容处理模式

### 条件语句使用场景
1. 风险等级判断：根据Q值确定风险级别
2. 物资充足性：判断是否需要补充物资
3. 外部支援：判断是否有外部救援协议

### 循环语句使用场景
1. 危险物质列表：遍历所有危险化学品
2. 应急队伍信息：遍历各应急小组
3. 应急物资清单：遍历所有应急物资
4. 环境受体信息：遍历周边敏感目标
5. 联系方式列表：遍历所有联系人

### 复杂数据结构处理
1. 嵌套循环：物资分类下的具体项目
2. 条件循环：只显示满足条件的项目
3. 计算字段：基于现有数据计算新值

## 模板语法规范

### 变量引用
- 简单变量：`{{ variable_name }}`
- 对象属性：`{{ object.property }}`
- 数组元素：`{{ array[index] }}`

### 条件语句
```jinja2
{% if condition %}
  内容
{% elif other_condition %}
  其他内容
{% else %}
  默认内容
{% endif %}
```

### 循环语句
```jinja2
{% for item in items %}
  {{ item.name }}：{{ item.value }}
{% endfor %}
```

### 注释
```jinja2
{# 这是注释 #}
```

### 过滤器使用
- 日期格式化：`{{ date|date('%Y-%m-%d') }}`
- 数字格式化：`{{ number|round(2) }}`
- 文本处理：`{{ text|upper }}`