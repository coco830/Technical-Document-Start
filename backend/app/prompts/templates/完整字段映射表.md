# 基于完整JSON Schema的字段 → 文案片段映射表

## JSON Schema结构分析

基于最新的 `emergency_plan.json` 文件，该Schema包含以下主要部分：
- `basic_info`: 企业基本信息
- `production_process`: 生产工艺信息
- `environment_info`: 环境信息
- `compliance_info`: 合规信息
- `emergency_resources`: 应急资源信息

## 完整字段映射表

### 企业基本信息字段 (basic_info)
| JSON路径 | 模板变量 | 使用场景 | 句法结构 | 示例 |
|----------|----------|----------|----------|------|
| basic_info.company_name | {{ basic_info.company_name }} | 企业名称 | `{{ basic_info.company_name }}` | 企业全称 |
| basic_info.company_short_name | {{ basic_info.company_short_name }} | 企业简称 | `{{ basic_info.company_short_name }}` | 企业简称 |
| basic_info.credit_code | {{ basic_info.credit_code }} | 机构代码 | `{{ basic_info.credit_code }}` | 统一社会信用代码 |
| basic_info.industry_category | {{ basic_info.industry_category }} | 行业类别 | `{{ basic_info.industry_category }}` | 制造业/服务业等 |
| basic_info.industry_subcategory | {{ basic_info.industry_subcategory }} | 行业子类 | `{{ basic_info.industry_subcategory }}` | 具体行业细分 |
| basic_info.park_name | {{ basic_info.park_name }} | 园区名称 | `{{ basic_info.park_name }}` | XX工业园区 |
| basic_info.risk_level | {{ basic_info.risk_level }} | 风险级别 | `{{ basic_info.risk_level }}` | 一般/较大/重大 |
| basic_info.address.province | {{ basic_info.address.province }} | 省份 | `{{ basic_info.address.province }}` | XX省 |
| basic_info.address.city | {{ basic_info.address.city }} | 城市 | `{{ basic_info.address.city }}` | XX市 |
| basic_info.address.district | {{ basic_info.address.district }} | 区县 | `{{ basic_info.address.district }}` | XX区 |
| basic_info.address.detail | {{ basic_info.address.detail }} | 详细地址 | `{{ basic_info.address.detail }}` | XX街道XX号 |
| basic_info.address.longitude | {{ basic_info.address.longitude }} | 经度 | `{{ basic_info.address.longitude }}` | 123.456 |
| basic_info.address.latitude | {{ basic_info.address.latitude }} | 纬度 | `{{ basic_info.address.latitude }}` | 45.678 |
| basic_info.contacts.legal_person.name | {{ basic_info.contacts.legal_person.name }} | 法定代表人姓名 | `{{ basic_info.contacts.legal_person.name }}` | 张三 |
| basic_info.contacts.legal_person.position | {{ basic_info.contacts.legal_person.position }} | 法定代表人职务 | `{{ basic_info.contacts.legal_person.position }}` | 董事长 |
| basic_info.contacts.legal_person.mobile | {{ basic_info.contacts.legal_person.mobile }} | 法定代表人电话 | `{{ basic_info.contacts.legal_person.mobile }}` | 13800138000 |
| basic_info.contacts.environmental_manager.name | {{ basic_info.contacts.environmental_manager.name }} | 环保负责人姓名 | `{{ basic_info.contacts.environmental_manager.name }}` | 李四 |
| basic_info.contacts.environmental_manager.position | {{ basic_info.contacts.environmental_manager.position }} | 环保负责人职务 | `{{ basic_info.contacts.environmental_manager.position }}` | 环保经理 |
| basic_info.contacts.environmental_manager.mobile | {{ basic_info.contacts.environmental_manager.mobile }} | 环保负责人电话 | `{{ basic_info.contacts.environmental_manager.mobile }}` | 13900139000 |
| basic_info.contacts.emergency_contact.name | {{ basic_info.contacts.emergency_contact.name }} | 应急联系人姓名 | `{{ basic_info.contacts.emergency_contact.name }}` | 王五 |
| basic_info.contacts.emergency_contact.position | {{ basic_info.contacts.emergency_contact.position }} | 应急联系人职务 | `{{ basic_info.contacts.emergency_contact.position }}` | 安全主管 |
| basic_info.contacts.emergency_contact.mobile | {{ basic_info.contacts.emergency_contact.mobile }} | 应急联系人电话 | `{{ basic_info.contacts.emergency_contact.mobile }}` | 13700137000 |
| basic_info.contacts.office_phone | {{ basic_info.contacts.office_phone }} | 办公电话 | `{{ basic_info.contacts.office_phone }}` | 021-12345678 |
| basic_info.contacts.email | {{ basic_info.contacts.email }} | 电子邮箱 | `{{ basic_info.contacts.email }}` | company@example.com |
| basic_info.operation.established_date | {{ basic_info.operation.established_date }} | 成立日期 | `{{ basic_info.operation.established_date }}` | 2020-01-01 |
| basic_info.operation.production_status | {{ basic_info.operation.production_status }} | 生产状态 | `{{ basic_info.operation.production_status }}` | 在产/停产/在建 |
| basic_info.operation.employees_total | {{ basic_info.operation.employees_total }} | 员工总数 | `{{ basic_info.operation.employees_total }}` | 100 |
| basic_info.operation.employees_production | {{ basic_info.operation.employees_production }} | 生产员工数 | `{{ basic_info.operation.employees_production }}` | 80 |
| basic_info.operation.work_shift | {{ basic_info.operation.work_shift }} | 工作制度 | `{{ basic_info.operation.work_shift }}` | 三班倒/常白班 |
| basic_info.operation.work_hours_per_shift | {{ basic_info.operation.work_hours_per_shift }} | 每班工作时长 | `{{ basic_info.operation.work_hours_per_shift }}` | 8 |
| basic_info.operation.operating_days_per_year | {{ basic_info.operation.operating_days_per_year }} | 年工作天数 | `{{ basic_info.operation.operating_days_per_year }}` | 300 |
| basic_info.operation.land_area | {{ basic_info.operation.land_area }} | 占地面积 | `{{ basic_info.operation.land_area }}` | 10000 |
| basic_info.operation.building_area | {{ basic_info.operation.building_area }} | 建筑面积 | `{{ basic_info.operation.building_area }}` | 5000 |
| basic_info.operation.investment_total | {{ basic_info.operation.investment_total }} | 总投资 | `{{ basic_info.operation.investment_total }}` | 10000000 |
| basic_info.operation.investment_environmental | {{ basic_info.operation.investment_environmental }} | 环保投资 | `{{ basic_info.operation.investment_environmental }}` | 1000000 |
| basic_info.operation.company_intro | {{ basic_info.operation.company_intro }} | 企业简介 | `{{ basic_info.operation.company_intro }}` | 企业基本情况描述 |

### 生产工艺信息字段 (production_process)
| JSON路径 | 模板变量 | 使用场景 | 句法结构 | 示例 |
|----------|----------|----------|----------|------|
| production_process.products | {% for product in production_process.products %}...{% endfor %} | 产品列表 | 循环遍历 | 产品名称、类型、产能等 |
| production_process.raw_materials | {% for material in production_process.raw_materials %}...{% endfor %} | 原料列表 | 循环遍历 | 原料名称、CAS号、类别等 |
| production_process.energy.water_consumption | {{ production_process.energy.water_consumption }} | 水消耗 | `{{ production_process.energy.water_consumption }}` | 年用水量 |
| production_process.energy.electricity_consumption | {{ production_process.energy.electricity_consumption }} | 电消耗 | `{{ production_process.energy.electricity_consumption }}` | 年用电量 |
| production_process.energy.natural_gas | {{ production_process.energy.natural_gas }} | 天然气消耗 | `{{ production_process.energy.natural_gas }}` | 年用气量 |
| production_process.energy.other_energy | {{ production_process.energy.other_energy }} | 其他能源 | `{{ production_process.energy.other_energy }}` | 其他能源描述 |
| production_process.process_description | {{ production_process.process_description }} | 工艺描述 | `{{ production_process.process_description }}` | 生产工艺流程描述 |
| production_process.storage_units | {% for unit in production_process.storage_units %}...{% endfor %} | 贮存单元 | 循环遍历 | 贮存设施信息 |
| production_process.hazardous_chemicals | {% for chemical in production_process.hazardous_chemicals %}...{% endfor %} | 危险化学品 | 循环遍历 | 危险化学品信息 |
| production_process.hazardous_waste | {% for waste in production_process.hazardous_waste %}...{% endfor %} | 危险废物 | 循环遍历 | 危险废物信息 |

### 环境信息字段 (environment_info)
| JSON路径 | 模板变量 | 使用场景 | 句法结构 | 示例 |
|----------|----------|----------|----------|------|
| environment_info.nearby_receivers | {% for receiver in environment_info.nearby_receivers %}...{% endfor %} | 环境受体 | 循环遍历 | 周边敏感目标信息 |
| environment_info.wastewater.production_wastewater | {% if environment_info.wastewater.production_wastewater %}是{% else %}否{% endif %} | 生产废水 | 条件判断 | 是否有生产废水 |
| environment_info.wastewater.domestic_wastewater | {% if environment_info.wastewater.domestic_wastewater %}是{% else %}否{% endif %} | 生活废水 | 条件判断 | 是否有生活废水 |
| environment_info.wastewater.treatment_facilities | {% for facility in environment_info.wastewater.treatment_facilities %}...{% endfor %} | 废水处理设施 | 循环遍历 | 处理设施信息 |
| environment_info.waste_gas.organized_sources | {% for source in environment_info.waste_gas.organized_sources %}...{% endfor %} | 有组织废气源 | 循环遍历 | 废气源信息 |
| environment_info.waste_gas.fugitive_sources_desc | {{ environment_info.waste_gas.fugitive_sources_desc }} | 无组织废气描述 | `{{ environment_info.waste_gas.fugitive_sources_desc }}` | 无组织废气源描述 |
| environment_info.noise | {% for noise in environment_info.noise %}...{% endfor %} | 噪声源 | 循环遍历 | 噪声源信息 |
| environment_info.solid_waste | {% for waste in environment_info.solid_waste %}...{% endfor %} | 固体废物 | 循环遍历 | 固体废物信息 |

### 合规信息字段 (compliance_info)
| JSON路径 | 模板变量 | 使用场景 | 句法结构 | 示例 |
|----------|----------|----------|----------|------|
| compliance_info.eia | {% if compliance_info.eia %}...{% endif %} | 环评信息 | 条件判断 | 环评批复信息 |
| compliance_info.acceptance | {% if compliance_info.acceptance %}...{% endif %} | 验收信息 | 条件判断 | 验收信息 |
| compliance_info.pollutant_permit | {% if compliance_info.pollutant_permit %}...{% endif %} | 排污许可证 | 条件判断 | 排污许可信息 |
| compliance_info.hazardous_waste_contracts | {% for contract in compliance_info.hazardous_waste_contracts %}...{% endfor %} | 危险废物合同 | 循环遍历 | 危险废物处置合同 |

### 应急资源信息字段 (emergency_resources)
| JSON路径 | 模板变量 | 使用场景 | 句法结构 | 示例 |
|----------|----------|----------|----------|------|
| emergency_resources.contact_list_internal | {% for contact in emergency_resources.contact_list_internal %}...{% endfor %} | 内部联系人 | 循环遍历 | 内部应急联系人 |
| emergency_resources.contact_list_external | {% for contact in emergency_resources.contact_list_external %}...{% endfor %} | 外部联系人 | 循环遍历 | 外部应急联系人 |
| emergency_resources.emergency_materials | {% for material in emergency_resources.emergency_materials %}...{% endfor %} | 应急物资 | 循环遍历 | 应急物资清单 |
| emergency_resources.emergency_team.has_internal_team | {% if emergency_resources.emergency_team.has_internal_team %}是{% else %}否{% endif %} | 是否有内部队伍 | 条件判断 | 内部应急队伍 |
| emergency_resources.emergency_team.team_size | {{ emergency_resources.emergency_team.team_size }} | 队伍规模 | `{{ emergency_resources.emergency_team.team_size }}` | 队伍人数 |
| emergency_resources.emergency_team.team_structure | {{ emergency_resources.emergency_team.team_structure }} | 队伍结构 | `{{ emergency_resources.emergency_team.team_structure }}` | 队伍组织结构 |
| emergency_resources.emergency_drills | {% for drill in emergency_resources.emergency_drills %}...{% endfor %} | 应急演练 | 循环遍历 | 应急演练记录 |

## 三个模板的特定字段映射

### 1. 环境风险评估报告 (template_risk_plan.jinja2)
| 变量名 | JSON路径 | 使用位置 | 条件逻辑 |
|--------|----------|----------|----------|
| {{ basic_info.company_name }} | basic_info.company_name | 标题、多处 | 必填 |
| {{ basic_info.address.longitude }} | basic_info.address.longitude | 地理位置 | 必填 |
| {{ basic_info.address.latitude }} | basic_info.address.latitude | 地理位置 | 必填 |
| {{ basic_info.operation.company_intro }} | basic_info.operation.company_intro | 企业概况 | 可选 |
| {% for receiver in environment_info.nearby_receivers %}...{% endfor %} | environment_info.nearby_receivers | 环境受体表格 | 循环 |
| {% for chemical in production_process.hazardous_chemicals %}...{% endfor %} | production_process.hazardous_chemicals | 危险物质表格 | 循环 |
| {% if q_value < 1 %}一般环境风险{% elif q_value < 10 %}较大环境风险{% else %}重大环境风险{% endif %} | 计算字段 | 风险等级判断 | 条件判断 |

### 2. 突发环境事件应急预案 (template_emergency_plan.jinja2)
| 变量名 | JSON路径 | 使用位置 | 条件逻辑 |
|--------|----------|----------|----------|
| {{ basic_info.company_name }} | basic_info.company_name | 标题、多处 | 必填 |
| {{ basic_info.risk_level }} | basic_info.risk_level | 风险级别 | 必填 |
| {{ basic_info.contacts.legal_person.name }} | basic_info.contacts.legal_person.name | 法定代表人 | 必填 |
| {{ basic_info.contacts.legal_person.mobile }} | basic_info.contacts.legal_person.mobile | 法定代表人电话 | 必填 |
| {{ basic_info.contacts.emergency_contact.name }} | basic_info.contacts.emergency_contact.name | 应急联系人 | 必填 |
| {{ basic_info.contacts.emergency_contact.mobile }} | basic_info.contacts.emergency_contact.mobile | 应急联系电话 | 必填 |
| {{ basic_info.address.detail }} | basic_info.address.detail | 地址 | 必填 |
| {{ basic_info.contacts.office_phone }} | basic_info.contacts.office_phone | 办公电话 | 必填 |
| {{ basic_info.contacts.email }} | basic_info.contacts.email | 电子邮箱 | 必填 |
| {% if basic_info.risk_level == '一般' %}一般环境风险等级（L）{% elif basic_info.risk_level == '较大' %}较大环境风险等级（M）{% elif basic_info.risk_level == '重大' %}重大环境风险等级（H）{% endif %} | basic_info.risk_level | 风险级别显示 | 条件判断 |
| {% for contact in emergency_resources.contact_list_internal %}...{% endfor %} | emergency_resources.contact_list_internal | 内部联系人表格 | 循环 |
| {% for material in emergency_resources.emergency_materials %}...{% endfor %} | emergency_resources.emergency_materials | 应急物资表格 | 循环 |
| {% for contact in emergency_resources.contact_list_external %}...{% endfor %} | emergency_resources.contact_list_external | 外部联系人表格 | 循环 |

### 3. 应急资源调查报告 (template_resource_investigation.jinja2)
| 变量名 | JSON路径 | 使用位置 | 条件逻辑 |
|--------|----------|----------|----------|
| {{ basic_info.company_name }} | basic_info.company_name | 标题、多处 | 必填 |
| {% if emergency_resources.emergency_team.has_internal_team %}...{% endif %} | emergency_resources.emergency_team.has_internal_team | 是否有内部队伍 | 条件判断 |
| {{ emergency_resources.emergency_team.team_size }} | emergency_resources.emergency_team.team_size | 队伍规模 | 必填 |
| {{ emergency_resources.emergency_team.team_structure }} | emergency_resources.emergency_team.team_structure | 队伍结构 | 必填 |
| {% for contact in emergency_resources.contact_list_internal %}...{% endfor %} | emergency_resources.contact_list_internal | 内部联系人表格 | 循环 |
| {% for material in emergency_resources.emergency_materials %}...{% endfor %} | emergency_resources.emergency_materials | 应急物资表格 | 循环 |
| {% for contact in emergency_resources.contact_list_external %}...{% endfor %} | emergency_resources.contact_list_external | 外部支援单位表格 | 循环 |

## 动态内容处理模式

### 条件语句使用场景
1. 风险等级判断：根据basic_info.risk_level或计算的Q值确定风险级别
2. 生产状态判断：根据basic_info.operation.production_status显示不同内容
3. 废水类型判断：根据environment_info.wastewater字段判断是否有生产/生活废水
4. 应急队伍判断：根据emergency_resources.emergency_team.has_internal_team判断是否显示队伍信息

### 循环语句使用场景
1. 产品列表：遍历production_process.products数组
2. 原料列表：遍历production_process.raw_materials数组
3. 危险化学品：遍历production_process.hazardous_chemicals数组
4. 环境受体：遍历environment_info.nearby_receivers数组
5. 应急物资：遍历emergency_resources.emergency_materials数组
6. 联系方式：遍历emergency_resources.contact_list_internal/external数组
7. 处理设施：遍历environment_info.wastewater.treatment_facilities数组

### 复杂数据结构处理
1. 嵌套对象：basic_info.address、basic_info.contacts等嵌套结构
2. 数组遍历：products、raw_materials、hazardous_chemicals等数组
3. 条件循环：结合条件语句和循环语句处理复杂逻辑
4. 计算字段：基于现有数据计算新值（如Q值计算）

## 模板语法规范

### 变量引用
- 简单变量：`{{ variable_name }}`
- 对象属性：`{{ object.property }}`
- 嵌套属性：`{{ object.parent.property }}`
- 数组元素：`{{ array[index] }}`（在循环中使用loop.index）

### 条件语句
```jinja2
{% if condition %}
  内容
{% elif other_condition %}
  其他内容
{% else %}
  默认内容
{% endif %}
```

### 循环语句
```jinja2
{% for item in items %}
  {{ item.name }}：{{ item.value }}
{% endfor %}
```

### 注释
```jinja2
{# 这是注释 #}
```

### 过滤器使用
- 日期格式化：`{{ date|date('%Y-%m-%d') }}`
- 数字格式化：`{{ number|round(2) }}`
- 文本处理：`{{ text|upper }}`
- 默认值：`{{ variable or '默认值' }}`

## 模板使用说明

1. 所有模板变量名与JSON Schema中的路径保持一致
2. 使用嵌套对象属性时，需要完整路径（如basic_info.company_name）
3. 数组遍历时，使用loop.index获取序号
4. 条件判断支持多级嵌套
5. 所有模板都支持默认值设置，防止数据缺失时出错

这套完整的字段映射表确保了Jinja2模板与JSON Schema的完全对应，支持动态内容生成和条件判断。